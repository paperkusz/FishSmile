<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>üåø GreenSync Duel ‚Äî Form ‚Üí Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Noto+Sans+Thai:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  :root{
    --bg:#f5f7fa;--text:#1f2430;--muted:#667085;--card:#fff;--border:#e5e7eb;
    --primary:#10b981;--primary-light:#d1fae5;--primary-dark:#047857;
    --secondary:#8b5cf6;--accent:#f59e0b;
    --theme-name: '‡∏ò‡∏µ‡∏°‡∏õ‡∏Å‡∏ï‡∏¥'; --theme-emoji: 'üåø';
  }

  /* ‡∏ò‡∏µ‡∏°‡πÄ‡∏î‡πá‡∏Å */
  .theme-kid{
    --bg:#e0f7fa;--text:#01579b;--muted:#4dd0e1;--card:#fff;--border:#b2ebf2;
    --primary:#00bcd4;--primary-light:#b2ebf2;--primary-dark:#00838f;
    --secondary:#ff4081;--accent:#ffc107;
    --theme-name: '‡∏ò‡∏µ‡∏°‡πÄ‡∏î‡πá‡∏Å'; --theme-emoji: 'üß∏';
  }

  /* ‡∏ò‡∏µ‡∏°‡∏ß‡∏±‡∏¢‡∏£‡∏∏‡πà‡∏ô */
  .theme-teen{
    --bg:#f3e5f5;--text:#4a148c;--muted:#8e24aa;--card:#fff;--border:#e1bee7;
    --primary:#9c27b0;--primary-light:#e1bee7;--primary-dark:#6a1b9a;
    --secondary:#ff9800;--accent:#4caf50;
    --theme-name: '‡∏ò‡∏µ‡∏°‡∏ß‡∏±‡∏¢‡∏£‡∏∏‡πà‡∏ô'; --theme-emoji: 'üõπ';
  }

  /* ‡∏ò‡∏µ‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà */
  .theme-adult{
    --bg:#f5f5f5;--text:#212121;--muted:#757575;--card:#fff;--border:#e0e0e0;
    --primary:#455a64;--primary-light:#cfd8dc;--primary-dark:#263238;
    --secondary:#607d8b;--accent:#ff5722;
    --theme-name: '‡∏ò‡∏µ‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà'; --theme-emoji: 'üíº';
  }

  /* ‡∏ò‡∏µ‡∏°‡∏ï‡∏£‡∏∏‡∏©‡∏à‡∏µ‡∏ô */
  .theme-cny{
    --bg:#fff9f9;--text:#b71c1c;--muted:#d32f2f;--card:#fff;--border:#ffcdd2;
    --primary:#d32f2f;--primary-light:#ffcdd2;--primary-dark:#b71c1c;
    --secondary:#ffc107;--accent:#4caf50;
    --theme-name: '‡∏ò‡∏µ‡∏°‡∏ï‡∏£‡∏∏‡∏©‡∏à‡∏µ‡∏ô'; --theme-emoji: 'üêâ';
  }

  /* ‡∏ò‡∏µ‡∏°‡∏ß‡∏≤‡πÄ‡∏•‡∏ô‡πÑ‡∏ó‡∏ô‡πå */
  .theme-valentine{
    --bg:#fff5f7;--text:#880e4f;--muted:#ad1457;--card:#fff;--border:#f8bbd9;
    --primary:#e91e63;--primary-light:#f8bbd9;--primary-dark:#ad1457;
    --secondary:#ec407a;--accent:#ab47bc;
    --theme-name: '‡∏ò‡∏µ‡∏°‡∏ß‡∏≤‡πÄ‡∏•‡∏ô‡πÑ‡∏ó‡∏ô‡πå'; --theme-emoji: 'üíù';
  }

  /* ‡∏ò‡∏µ‡∏°‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà */
  .theme-newyear{
    --bg:#f0f8ff;--text:#0d47a1;--muted:#1565c0;--card:#fff;--border:#bbdefb;
    --primary:#0d47a1;--primary-light:#bbdefb;--primary-dark:#002171;
    --secondary:#ff6d00;--accent:#00c853;
    --theme-name: '‡∏ò‡∏µ‡∏°‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà'; --theme-emoji: 'üéâ';
  }

  body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    font-family:Inter,"Noto Sans Thai",system-ui;
    transition: all 0.3s ease;
  }
  .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
  .h1{font-weight:700;font-size:28px}
  .muted{color:var(--muted)}
  .card{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:16px;
    box-shadow:0 6px 18px rgba(0,0,0,.06);
    margin-bottom:16px;
    transition: all 0.3s ease;
  }
  .hd{
    padding:14px 16px;
    border-bottom:1px solid var(--border);
    font-weight:600;
    background: var(--primary-light);
    color: var(--primary-dark);
    transition: all 0.3s ease;
  }
  .bd{padding:14px 16px}
  label{display:block;margin-bottom:6px;font-size:14px}
  input,select{
    width:100%;
    padding:10px 12px;
    border:1px solid var(--border);
    border-radius:10px;
    transition: all 0.2s ease;
  }
  input:focus, select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px var(--primary-light);
  }
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .btn{
    display:inline-flex;
    gap:8px;
    align-items:center;
    border-radius:999px;
    padding:10px 16px;
    border:1px solid var(--primary);
    background:var(--primary);
    color:#fff;
    cursor:pointer;
    font-weight:600;
    transition: all 0.2s ease;
  }
  .btn:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  @media(max-width:900px){.row{grid-template-columns:1fr}.grid2{grid-template-columns:1fr}}
  .kpi{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:8px}
  .kpi .it{
    background:#f8fafc;
    border:1px solid var(--border);
    border-radius:12px;
    padding:8px 10px;
    transition: all 0.2s ease;
  }
  .kpi .it:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.08);
  }
  .kpi .v{font-weight:700}
  .hearts{font-size:28px;line-height:1.1;color:#e91e63}

  /* ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡∏ò‡∏µ‡∏° */
  .theme-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding: 16px;
    background: var(--card);
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    border: 1px solid var(--border);
    transition: all 0.3s ease;
  }

  .theme-selector {
    position: relative;
    display: inline-block;
  }

  .theme-main-btn {
    padding: 10px 16px;
    border-radius: 20px;
    border: 1px solid var(--primary);
    background: var(--primary);
    color: white;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
  }

  .theme-main-btn:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }

  .theme-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 8px;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    padding: 8px;
    min-width: 180px;
    z-index: 100;
    display: none;
    flex-direction: column;
    gap: 4px;
  }

  .theme-dropdown.show {
    display: flex;
    animation: fadeIn 0.2s ease;
  }

  .theme-option {
    padding: 10px 12px;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.2s ease;
  }

  .theme-option:hover {
    background: var(--primary-light);
  }

  .theme-option.active {
    background: var(--primary-light);
    color: var(--primary-dark);
    font-weight: 600;
  }

  .theme-emoji {
    font-size: 18px;
  }

  .theme-name {
    flex: 1;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ò‡∏µ‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ */
  .theme-kid .card {
    border-radius: 20px;
    box-shadow: 0 8px 25px rgba(0, 188, 212, 0.15);
  }

  .theme-kid .kpi .it {
    border-radius: 16px;
    background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%);
  }

  .theme-teen .card {
    border-radius: 12px;
    box-shadow: 0 8px 25px rgba(156, 39, 176, 0.15);
  }

  .theme-teen .kpi .it {
    border-radius: 10px;
    background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
  }

  .theme-adult .card {
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  }

  .theme-adult .kpi .it {
    border-radius: 6px;
    background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
  }

  .theme-cny .card {
    border-radius: 16px;
    box-shadow: 0 8px 25px rgba(211, 47, 47, 0.15);
    border: 2px solid var(--primary);
  }

  .theme-cny .kpi .it {
    border-radius: 12px;
    background: linear-gradient(135deg, #fff9f9 0%, #ffcdd2 100%);
  }

  .theme-valentine .card {
    border-radius: 20px;
    box-shadow: 0 8px 25px rgba(233, 30, 99, 0.15);
    border: 2px dashed var(--primary);
  }

  .theme-valentine .kpi .it {
    border-radius: 16px;
    background: linear-gradient(135deg, #fff5f7 0%, #f8bbd9 100%);
  }

  .theme-newyear .card {
    border-radius: 16px;
    box-shadow: 0 8px 25px rgba(13, 71, 161, 0.15);
    border: 2px dotted var(--primary);
  }

  .theme-newyear .kpi .it {
    border-radius: 12px;
    background: linear-gradient(135deg, #f0f8ff 0%, #bbdefb 100%);
  }

  @media (max-width:900px){ 
    .theme-header {
      flex-direction: column;
      gap: 16px;
    }
    .theme-selector {
      width: 100%;
    }
    .theme-main-btn {
      width: 100%;
      justify-content: center;
    }
    .theme-dropdown {
      width: 100%;
      right: auto;
      left: 0;
    }
  }
</style>
</head>
<body>
<div class="wrap">
  <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡∏ò‡∏µ‡∏° -->
  <div class="theme-header">
    <div>
      <div class="h1"><span id="theme-emoji">üåø</span> GreenSync ‚Äî Duel Mode</div>
      <div class="muted">‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå ‚Üí ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô ‚Üí ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î 2 ‡∏Å‡∏£‡∏∞‡∏ñ‡∏≤‡∏á ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏´‡∏±‡∏ß‡πÉ‡∏à</div>
      <div class="muted" style="margin-top: 8px;">‡∏ò‡∏µ‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: <span id="current-theme">‡∏ò‡∏µ‡∏°‡∏õ‡∏Å‡∏ï‡∏¥</span></div>
    </div>
    <div class="theme-selector">
      <button class="theme-main-btn" id="themeMainBtn">
        <i class="fas fa-palette"></i>
        <span>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ò‡∏µ‡∏°</span>
        <i class="fas fa-chevron-down"></i>
      </button>
      <div class="theme-dropdown" id="themeDropdown">
        <div class="theme-option active" data-theme="default">
          <span class="theme-emoji">üåø</span>
          <span class="theme-name">‡∏ò‡∏µ‡∏°‡∏õ‡∏Å‡∏ï‡∏¥</span>
        </div>
        <div class="theme-option" data-theme="kid">
          <span class="theme-emoji">üß∏</span>
          <span class="theme-name">‡∏ò‡∏µ‡∏°‡πÄ‡∏î‡πá‡∏Å</span>
        </div>
        <div class="theme-option" data-theme="teen">
          <span class="theme-emoji">üõπ</span>
          <span class="theme-name">‡∏ò‡∏µ‡∏°‡∏ß‡∏±‡∏¢‡∏£‡∏∏‡πà‡∏ô</span>
        </div>
        <div class="theme-option" data-theme="adult">
          <span class="theme-emoji">üíº</span>
          <span class="theme-name">‡∏ò‡∏µ‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà</span>
        </div>
        <div class="theme-option" data-theme="cny">
          <span class="theme-emoji">üêâ</span>
          <span class="theme-name">‡∏ò‡∏µ‡∏°‡∏ï‡∏£‡∏∏‡∏©‡∏à‡∏µ‡∏ô</span>
        </div>
        <div class="theme-option" data-theme="valentine">
          <span class="theme-emoji">üíù</span>
          <span class="theme-name">‡∏ò‡∏µ‡∏°‡∏ß‡∏≤‡πÄ‡∏•‡∏ô‡πÑ‡∏ó‡∏ô‡πå</span>
        </div>
        <div class="theme-option" data-theme="newyear">
          <span class="theme-emoji">üéâ</span>
          <span class="theme-name">‡∏ò‡∏µ‡∏°‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà</span>
        </div>
      </div>
    </div>
  </div>

  <!-- SECTION 1: FORM -->
  <div class="card" id="secForm">
    <div class="hd">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå & ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</div>
    <div class="bd">
      <div class="row">
        <div>
          <label>Web App URL (Apps Script)</label>
          <input id="webapp" placeholder="https://script.google.com/macros/s/DEPLOYMENT_ID/exec">
        </div>
        <div>
          <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ñ‡∏ß‡∏î‡∏∂‡∏á‡πÅ‡∏™‡∏î‡∏á (limit)</label>
          <select id="limit"><option>10</option><option selected>50</option><option>100</option></select>
        </div>
      </div>
      <div class="row" style="margin-top:8px">
        <div>
          <label>‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ</label>
          <input id="plant" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏¢‡∏≤‡∏á‡∏≠‡∏¥‡∏ô‡πÄ‡∏î‡∏µ‡∏¢ / ‡∏°‡∏≠‡∏ô‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πà‡∏≤">
        </div>
        <div>
          <label>‡∏Ç‡∏ô‡∏≤‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏π‡∏Å</label>
          <input id="size" placeholder="‡πÄ‡∏ä‡πà‡∏ô 2 x 3 ‡πÄ‡∏°‡∏ï‡∏£">
        </div>
      </div>
      <div class="row" style="margin-top:8px">
        <div>
          <label>‡πÅ‡∏™‡∏á</label>
          <select id="lightCond"><option>‡∏û‡∏≠‡∏°‡∏≤‡∏Å</option><option selected>‡∏û‡∏≠‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</option><option>‡∏ô‡πâ‡∏≠‡∏¢/‡∏≠‡∏±‡∏ö‡πÅ‡∏™‡∏á</option></select>
        </div>
        <div>
          <label>‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡πÄ‡∏ó‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</label>
          <select id="airflow"><option>‡πÇ‡∏õ‡∏£‡πà‡∏á</option><option selected>‡∏û‡∏≠‡πÉ‡∏ä‡πâ</option><option>‡∏≠‡∏±‡∏ö</option></select>
        </div>
      </div>
      <div class="row" style="margin-top:8px">
        <div>
          <label>‡πÅ‡∏≠‡∏£‡πå</label>
          <select id="ac"><option>‡∏ï‡∏•‡∏≠‡∏î‡∏ß‡∏±‡∏ô</option><option selected>‡∏ö‡∏≤‡∏á‡πÄ‡∏ß‡∏•‡∏≤</option><option>‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î</option></select>
        </div>
        <div>
          <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏•‡∏π‡∏Å (‡∏ó‡∏µ‡∏° A / ‡∏ó‡∏µ‡∏° B ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)</label>
          <input id="name" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏£‡∏π‡∏£‡∏±‡∏ä‡∏û‡∏•">
        </div>
      </div>
      <div style="margin-top:12px">
        <button class="btn" id="btnStart">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô ‚ûú ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</button>
        <span class="muted" id="status"></span>
      </div>
    </div>
  </div>

  <!-- SECTION 2: DASHBOARD -->
  <div class="card" id="secDash" style="display:none">
    <div class="hd">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î 2 ‡∏Å‡∏£‡∏∞‡∏ñ‡∏≤‡∏á (‡∏ó‡∏µ‡∏° A vs ‡∏ó‡∏µ‡∏° B)</div>
    <div class="bd grid2">
      <!-- LEFT -->
      <div>
        <div class="muted">‡∏ó‡∏µ‡∏° A</div>
        <div class="kpi" style="margin-top:8px">
          <div class="it"><div>Temp (¬∞C)</div><div class="v" id="a_temp">-</div></div>
          <div class="it"><div>Humid (%)</div><div class="v" id="a_hum">-</div></div>
          <div class="it"><div>Soil (%)</div><div class="v" id="a_soil">-</div></div>
          <div class="it"><div>Light (%)</div><div class="v" id="a_light">-</div></div>
        </div>
        <div style="margin-top:8px">‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ:</div>
        <div class="hearts" id="a_hearts">‚Äî</div>
        <div class="muted" id="a_advice" style="margin-top:6px">‚Äî</div>
        <table style="margin-top:10px;width:100%;border-collapse:collapse">
          <thead><tr><th style="text-align:left">‡πÄ‡∏ß‡∏•‡∏≤</th><th>Temp</th><th>RH</th><th>Soil</th><th>Light</th></tr></thead>
          <tbody id="a_tbl"></tbody>
        </table>
      </div>

      <!-- RIGHT -->
      <div>
        <div class="muted">‡∏ó‡∏µ‡∏° B</div>
        <div class="kpi" style="margin-top:8px">
          <div class="it"><div>Temp (¬∞C)</div><div class="v" id="b_temp">-</div></div>
          <div class="it"><div>Humid (%)</div><div class="v" id="b_hum">-</div></div>
          <div class="it"><div>Soil (%)</div><div class="v" id="b_soil">-</div></div>
          <div class="it"><div>Light (%)</div><div class="v" id="b_light">-</div></div>
        </div>
        <div style="margin-top:8px">‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ:</div>
        <div class="hearts" id="b_hearts">‚Äî</div>
        <div class="muted" id="b_advice" style="margin-top:6px">‚Äî</div>
        <table style="margin-top:10px;width:100%;border-collapse:collapse">
          <thead><tr><th style="text-align:left">‡πÄ‡∏ß‡∏•‡∏≤</th><th>Temp</th><th>RH</th><th>Soil</th><th>Light</th></tr></thead>
          <tbody id="b_tbl"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);
const fmt = v => (v==null||v==="")?"-":v;
const hearts = n => n>0? "‚ù§".repeat(Math.max(1,Math.min(10,Math.round(n)))) : "‚Äî";

/* --------------- Theme Management --------------- */
function setTheme(themeName) {
  // ‡∏•‡∏ö‡∏Ñ‡∏•‡∏≤‡∏™‡∏ò‡∏µ‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  document.body.classList.remove('theme-kid', 'theme-teen', 'theme-adult', 'theme-cny', 'theme-valentine', 'theme-newyear');
  
  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏•‡∏≤‡∏™‡∏ò‡∏µ‡∏°‡πÉ‡∏´‡∏°‡πà‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ò‡∏µ‡∏°‡∏õ‡∏Å‡∏ï‡∏¥
  if (themeName !== 'default') {
    document.body.classList.add(`theme-${themeName}`);
  }
  
  // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏õ‡∏∏‡πà‡∏°‡∏ò‡∏µ‡∏°
  $$('.theme-option').forEach(option => {
    option.classList.remove('active');
    if (option.dataset.theme === themeName) {
      option.classList.add('active');
    }
  });
  
  // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ò‡∏µ‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡∏µ‡πÇ‡∏°‡∏à‡∏¥
  $('#current-theme').textContent = getThemeName(themeName);
  $('#theme-emoji').textContent = getThemeEmoji(themeName);
  
  // ‡∏õ‡∏¥‡∏î dropdown
  $('#themeDropdown').classList.remove('show');
  
  // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ò‡∏µ‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
  localStorage.setItem('selectedTheme', themeName);
}

function getThemeName(themeKey) {
  const themeNames = {
    'default': '‡∏ò‡∏µ‡∏°‡∏õ‡∏Å‡∏ï‡∏¥',
    'kid': '‡∏ò‡∏µ‡∏°‡πÄ‡∏î‡πá‡∏Å',
    'teen': '‡∏ò‡∏µ‡∏°‡∏ß‡∏±‡∏¢‡∏£‡∏∏‡πà‡∏ô',
    'adult': '‡∏ò‡∏µ‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà',
    'cny': '‡∏ò‡∏µ‡∏°‡∏ï‡∏£‡∏∏‡∏©‡∏à‡∏µ‡∏ô',
    'valentine': '‡∏ò‡∏µ‡∏°‡∏ß‡∏≤‡πÄ‡∏•‡∏ô‡πÑ‡∏ó‡∏ô‡πå',
    'newyear': '‡∏ò‡∏µ‡∏°‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà'
  };
  return themeNames[themeKey] || '‡∏ò‡∏µ‡∏°‡∏õ‡∏Å‡∏ï‡∏¥';
}

function getThemeEmoji(themeKey) {
  const themeEmojis = {
    'default': 'üåø',
    'kid': 'üß∏',
    'teen': 'üõπ',
    'adult': 'üíº',
    'cny': 'üêâ',
    'valentine': 'üíù',
    'newyear': 'üéâ'
  };
  return themeEmojis[themeKey] || 'üåø';
}

// ‡πÇ‡∏´‡∏•‡∏î‡∏ò‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ
const savedTheme = localStorage.getItem('selectedTheme') || 'default';
setTheme(savedTheme);

// ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏ò‡∏µ‡∏°‡∏´‡∏•‡∏±‡∏Å
$('#themeMainBtn').addEventListener('click', (e) => {
  e.stopPropagation();
  $('#themeDropdown').classList.toggle('show');
});

// ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ò‡∏µ‡∏°
$$('.theme-option').forEach(option => {
  option.addEventListener('click', () => {
    setTheme(option.dataset.theme);
  });
});

// ‡∏õ‡∏¥‡∏î dropdown ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏∑‡πà‡∏ô
document.addEventListener('click', () => {
  $('#themeDropdown').classList.remove('show');
});

// 1) ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡∏° A/B ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
$("#btnStart").addEventListener("click", async ()=>{
  const base = $("#webapp").value.trim();
  if(!base){ $("#status").textContent="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Web App URL (‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢ /exec)"; return; }
  const pf = {
    action:"saveProfile",
    name: $("#name").value.trim(),
    plant: $("#plant").value.trim(),
    size: $("#size").value.trim(),
    light: $("#lightCond").value,
    airflow: $("#airflow").value,
    ac: $("#ac").value
  };
  $("#status").textContent="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡∏° A/B...";

  await fetch(base, {method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...pf, team:"A"})});
  await fetch(base, {method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...pf, team:"B"})});

  // ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
  $("#secForm").style.display="none";
  $("#secDash").style.display="block";

  // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• + ‡∏™‡∏±‡πà‡∏á AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
  startDashboard(base, Number($("#limit").value || 50));
});

async function startDashboard(base, limit){
  async function fetchData(team){
    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏î
    const dataUrl = new URL(base);
    dataUrl.searchParams.set("action","data");
    dataUrl.searchParams.set("team",team);
    dataUrl.searchParams.set("limit",limit);
    const dj = await (await fetch(dataUrl)).json().catch(()=>({rows:[]}));
    // ‡∏™‡∏±‡πà‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ä‡∏µ‡∏ï AI_PlantScore)
    const anaUrl = new URL(base);
    anaUrl.searchParams.set("action","analyzeNow");
    anaUrl.searchParams.set("team",team);
    await fetch(anaUrl).catch(()=>{});
    // ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    const scoreUrl = new URL(base);
    scoreUrl.searchParams.set("action","score");
    scoreUrl.searchParams.set("team",team);
    const sj = await (await fetch(scoreUrl)).json().catch(()=>({rows:[]}));
    return {rows: dj.rows||[], scores: sj.rows||[]};
  }

  async function render(team, prefix){
    const {rows, scores} = await fetchData(team);

    // KPI ‡∏à‡∏≤‡∏Å‡πÅ‡∏ñ‡∏ß‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    if(rows.length){
      const r = rows[0];
      $("#"+prefix+"temp").textContent = fmt(Number(r["Temperature (¬∞C)"]).toFixed(1));
      $("#"+prefix+"hum").textContent  = fmt(r["Air Humidity (%)"]);
      $("#"+prefix+"soil").textContent = fmt(r["Soil Moisture (%)"]);
      $("#"+prefix+"light").textContent= fmt(r["Light (%)"]);
      const tb = $("#"+prefix+"tbl"); tb.innerHTML="";
      rows.slice(0,50).forEach(o=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${fmt(o["Timestamp (Asia/Bangkok)"])}</td>
                        <td style="text-align:center">${fmt(o["Temperature (¬∞C)"])}</td>
                        <td style="text-align:center">${fmt(o["Air Humidity (%)"])}</td>
                        <td style="text-align:center">${fmt(o["Soil Moisture (%)"])}</td>
                        <td style="text-align:center">${fmt(o["Light (%)"])}</td>`;
        tb.appendChild(tr);
      });
    }

    // ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏à‡∏≤‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    if(scores.length){
      const s = Number(scores[0]["Score_1_10"])||0;
      const adv = scores[0]["Advice"]||"";
      $("#"+prefix+"hearts").textContent = hearts(s);
      $("#"+prefix+"advice").textContent = adv? ("‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: "+adv) : "‚Äî";
    } else {
      $("#"+prefix+"hearts").textContent = "‚Äî";
      $("#"+prefix+"advice").textContent = "‚Äî";
    }
  }

  // ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å + ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å 20 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
  const run = ()=>{ render("A","a_"); render("B","b_"); };
  run();
  setInterval(run, 20000);
}
</script>
</body>
</html>
